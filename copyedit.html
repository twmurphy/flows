<!DOCTYPE html>
        <html>
          <head>
            <title>Flowise Image Upload</title>
            <style>
              body {
                font-family: sans-serif;
                padding: 20px;
                max-width: 600px;
              }
              #preview {
                max-width: 100%;
                margin-top: 10px;
                display: none;
              }
              #response {
                margin-top: 20px;
                padding: 12px;
                border-radius: 6px;
                background: #f9f9f9;
                border: 1px solid #ccc;
                display: none;
              }
              #spinner {
                margin-top: 10px;
                display: none;
              }
              .loader {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #555;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                animation: spin 1s linear infinite;
                margin: 0 auto;
              }
              @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
              }
            </style>
          </head>
          <body>
            <h2>Paste an Image and Submit to Flowise</h2>
            <textarea id="input" placeholder="Paste image here and enter question..." rows="4" cols="50"></textarea><br>
            <img id="preview" />
            <br>
            <button id="submit">Submit</button>
        
            <div id="spinner"><div class="loader"></div></div>
            <div id="response"></div>
        
            <script>
              let base64Image = null;
              let imageMime = null;
              let imageName = null;
        
              const input = document.getElementById('input');
              const preview = document.getElementById('preview');
              const submitBtn = document.getElementById('submit');
              const responseBox = document.getElementById('response');
              const spinner = document.getElementById('spinner');
        
              input.addEventListener('paste', async (event) => {
                const items = event.clipboardData.items;
                for (const item of items) {
                  if (item.type.startsWith('image/')) {
                    const file = item.getAsFile();
                    const reader = new FileReader();
        
                    reader.onload = function (e) {
                      base64Image = e.target.result;
                      imageMime = file.type;
                      imageName = file.name || 'pasted-image.png';
        
                      preview.src = base64Image;
                      preview.style.display = 'block';
                    };
        
                    reader.readAsDataURL(file);
                  }
                }
              });
        
              submitBtn.addEventListener('click', async () => {
                const text = input.value.trim() || 'Image input';
                if (!base64Image) {
                  alert('Please paste an image first.');
                  return;
                }
        
                const chatflowid = '4a7cf398-fd2f-4359-857c-877cc3cf58e6';
                const url = `https://cloud.flowiseai.com/api/v1/prediction/${chatflowid}`;
        
                const payload = {
                  question: text,
                  uploads: [
                    {
                      type: 'file',
                      name: imageName,
                      mime: imageMime,
                      data: base64Image
                    }
                  ]
                };
        
                spinner.style.display = 'block';
                responseBox.style.display = 'none';
                responseBox.textContent = '';
        
                try {
                  const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                  });
        
                  const data = await res.json();
        
                  let finalText = '';
                  if (typeof data === 'string') {
                    finalText = data;
                  } else if (data?.text) {
                    finalText = data.text;
                  } else if (data?.data?.text) {
                    finalText = data.data.text;
                  } else {
                    finalText = '[No output found in response]';
                  }
        
                  responseBox.style.display = 'block';
                  responseBox.innerHTML = `<strong>Response:</strong><br>${data.text}`;
                  console.log(data);
                } catch (err) {
                  responseBox.style.display = 'block';
                  responseBox.textContent = 'Error: ' + err.message;
                } finally {
                  spinner.style.display = 'none';
                }
              });
            </script>
          </body>
        </html>
        
